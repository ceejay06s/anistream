# Backblaze B2 Storage Setup

## Overview
The application now uses Backblaze B2 for file storage instead of Firebase Storage. This avoids CORS issues and doesn't require a Firebase Blaze plan.

## Your Backblaze B2 Configuration
- **Bucket Name**: `anistream-bckt`
- **Bucket ID**: `9f956392471c6d4d99cb0d1e`
- **Type**: Private
- **Endpoint**: `s3.us-east-005.backblazeb2.com`
- **Region**: `us-east-005`

## Setup Instructions

### 1. Get Your Backblaze Credentials

1. Go to [Backblaze B2 Console](https://secure.backblaze.com/user_signin.htm)
2. Navigate to **App Keys** (in the left sidebar)
3. Click **Add a New Application Key**
4. Configure:
   - **Name**: `anistream-backend` (or any name you prefer)
   - **Allow List All Buckets**: Yes (or select specific bucket)
   - **Allow Read Files**: Yes
   - **Allow Write Files**: Yes
   - **Allow Delete Files**: Yes (optional, for cleanup)
5. Click **Create New Key**
6. **IMPORTANT**: Copy both:
   - **keyID** (Application Key ID)
   - **applicationKey** (Application Key) - This is only shown once!

### 2. Configure Environment Variables

Add these to your `.env` file in `backend-hono/`:

```env
# Backblaze B2 Configuration
BACKBLAZE_KEY_ID=your_key_id_here
BACKBLAZE_APPLICATION_KEY=your_application_key_here
BACKBLAZE_BUCKET_NAME=anistream-bckt
BACKBLAZE_ENDPOINT=https://s3.us-east-005.backblazeb2.com
BACKBLAZE_REGION=us-east-005
```

### 3. For Render Deployment

Add these environment variables in Render Dashboard:

1. Go to your Render service dashboard
2. Navigate to **Environment** tab
3. Add the following variables:
   - `BACKBLAZE_KEY_ID` = Your Application Key ID
   - `BACKBLAZE_APPLICATION_KEY` = Your Application Key
   - `BACKBLAZE_BUCKET_NAME` = `anistream-bckt`
   - `BACKBLAZE_ENDPOINT` = `https://s3.us-east-005.backblazeb2.com`
   - `BACKBLAZE_REGION` = `us-east-005`

### 4. Test the Setup

1. Start your backend server:
   ```bash
   cd backend-hono
   npm run dev
   ```

2. Test file upload:
   ```bash
   curl -X POST http://localhost:8801/api/upload/file \
     -F "file=@test-image.jpg" \
     -F "userId=test-user-123" \
     -F "folder=posts"
   ```

## Bucket Configuration

### Private vs Public Bucket

Your bucket is currently set to **Private**. This means:
- Files are uploaded securely
- Access requires signed URLs (generated automatically)
- Signed URLs are valid for 1 year

### Making Bucket Public (Optional)

If you want public URLs without signing:

1. Go to Backblaze B2 Console
2. Select your bucket: `anistream-bckt`
3. Click **Bucket Settings**
4. Under **Files in Bucket are**: Select **Public**
5. Save changes

**Note**: Public buckets allow anyone with the URL to access files. Use with caution.

## File URLs

### Private Bucket (Current Setup)
- Files use **signed URLs** (valid for 1 year)
- Format: `https://s3.us-east-005.backblazeb2.com/anistream-bckt/[path]?[signature]`
- Automatically generated by the backend

### Public Bucket
- Files use **public URLs**
- Format: `https://anistream-bckt.s3.us-east-005.backblazeb2.com/[path]`
- No signature required

## Pricing

Backblaze B2 offers:
- **10GB free storage** (first 10GB)
- **1GB free download** per day
- Very affordable pricing after free tier
- No egress fees for first 1GB/day

## Troubleshooting

### Error: "Backblaze credentials not configured"
- Check that `BACKBLAZE_KEY_ID` and `BACKBLAZE_APPLICATION_KEY` are set
- Verify credentials in Backblaze B2 Console

### Error: "Access Denied"
- Verify the Application Key has proper permissions
- Check that the bucket name matches: `anistream-bckt`
- Ensure the endpoint is correct: `https://s3.us-east-005.backblazeb2.com`

### Files not accessible
- If bucket is private, ensure you're using signed URLs (handled automatically)
- If bucket is public, check bucket settings in Backblaze Console

## Security Notes

- **Never commit** your Application Key to Git
- Use environment variables for all credentials
- Rotate keys periodically for security
- The Application Key is only shown once - save it securely!
